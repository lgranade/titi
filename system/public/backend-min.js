document.addEventListener("DOMContentLoaded",function(a){var g=document.querySelector("#ajax_add_distributor");if(g){g.addEventListener("change",function(){var p=new XMLHttpRequest();var q=document.querySelector("#ajax_distributors");var r=document.querySelector(".messages");p.addEventListener("loadstart",function u(){q.innerHTML="Cargando..."});p.addEventListener("progress",function t(w){if(w.lengthComputable){r.max=w.total;r.value=w.loaded}});p.addEventListener("abort",f,false);p.addEventListener("error",m,false);p.addEventListener("load",function s(w){if(p.status==200){q.innerHTML=p.responseText;o(r,"Cambios en proveedores guardados con exito","notice")}else{q.innerHTML="Error: "+p.responseText;o(r,p.responseText,"error")}g.value=""});var i=this.dataset.url+this.value;p.open("POST",i,true);p.setRequestHeader("Content-type","application/x-www-form-urlencoded");var v=this.dataset.csrfKey+"="+encodeURIComponent(this.dataset.csrfToken);p.send(v)},false)}function o(q,r,p){q.innerHTML="";var i=l("div","⚫ "+r);i.className+="flash flash_"+p+" bounceInDown";q.appendChild(i)}function m(i){alert("Error de transferencia.")}function f(i){alert("Transferencia cancelada.")}el=document.querySelectorAll(".ajax_hide_on_click");for(var d=0;d<el.length;d++){el[d].addEventListener("click",function(){this.classList.add("hide")},false)}el=document.querySelectorAll(".ajax_hide_parent_on_click");for(var d=0;d<el.length;d++){el[d].addEventListener("click",function(p){p.stopPropagation();p.preventDefault();var i=h(this,this.dataset.tag);i.classList.add("hide");setTimeout(function(){i.style.display="none"},700)},false)}function h(p,i){i=i.toLowerCase();do{p=p.parentNode;if(p.tagName.toLowerCase()==i){return p}}while(p.parentNode);return null}$(".ajax_confirm").click(function(){var i=confirm($(this).data("confirm_message"));return i});$(".ajax_hide_items").click(function(){$(".items").hide("slow")});$(".toggle_me").hide();$(".toggle_link").click(function(i){$(this).next(".toggle_me").toggle("slow");$(this).toggleClass("current").focus()});$(".autoselect").focus().select();$("input[name=i_id]").attr("autocomplete","off");$("a.edit").focusin(function(){$(this).closest("tr").addClass("item_hover")}).focusout(function(){$(this).closest("tr").removeClass("item_hover")}).click(function(){$(this).closest("tr").removeClass("item_hover")});$(".ajax_item").click(function(){window.location.href=$(this).find("a").attr("href")});$(".flash.notice").parent().addClass("flash_notice");$(".flash").hover(function(){$(this).addClass("bounceOutUp")});setTimeout(function(){$(".flash_notice").addClass("bounceOutUp")},5000);setTimeout(function(){$(".flash_warning").addClass("bounceOutUp")},10000);function n(q){var p=document.querySelector("#ajax_item_distributors");p.innerHTML="";var i=JSON.parse(q);p.appendChild(c("⚫ "+JSON.parse(i[d]).d_name))}function c(q){var i=document.createElement("p");i.appendChild(document.createTextNode(q));return i}function l(i,q){var p=document.createElement(i);p.appendChild(document.createTextNode(q));return p}$(".edit_bulk").click(function(q){q.preventDefault();q.stopPropagation();var p=$(this).closest("tr"),i="/admin/bulks/"+q.target.dataset.b_id;$.ajax({type:"GET",url:i,beforeSend:function(){p.html('<td colspan="6" class="loading"><img src="/media/loading.gif" alt="Cargando..." /></td>')},success:function(r){p.html(r);$("[autofocus]").focus().select()},error:function(){$("#ajax_panel").html('<p class="error"><strong>Oops!</strong> Proba denuevo.</p>')}})});$("form").on("keyup","select[name=b_status]",function(i){if(i.keyCode==13){$(this).closest("form").submit()}});$("input[type=tel].number.positive").on({focus:function(i){original=this.value},keyup:function(i){if(~this.value.indexOf("-")){this.value=this.value.replace(/[\-]/g,"")}if(!j(this.value)){this.value=original}}});$("form").on("keyup","#ajax_product_buy_cost",function(i){e()});$("#ajax_product_price").on({focus:function(i){original_price=document.getElementById("ajax_product_price").value},keyup:function(i){if(this.value.length>0&&this.value!=original_price){e();k()}}});function j(i){return parseFloat(i.replace(/[\,]/g,"."))==Number(i.replace(/[\,]/g,"."))}function b(i){return Number(i.replace(/[\,]/g,"."))}function e(){buy_cost=document.getElementById("ajax_product_buy_cost");parts_cost=document.getElementById("ajax_product_parts_cost");materials_cost=document.getElementById("ajax_product_materials_cost");sale_cost=document.getElementById("ajax_product_sale_cost");ideal_markup=document.getElementById("ajax_product_ideal_markup");real_markup=document.getElementById("ajax_product_real_markup");price=document.getElementById("ajax_product_price");var r=b(price.value)/(b(buy_cost.value)+b(parts_cost.value)+b(materials_cost.value));var q=Math.round(r*1000)/1000;real_markup.value=q;if(ideal_markup.value==""||ideal_markup.value==0||ideal_markup.value==Infinity||ideal_markup.value==NaN){ideal_markup.value=real_markup.value}var p=b(buy_cost.value)+b(parts_cost.value)+b(materials_cost.value);var i=Math.round(p*1000)/1000;sale_cost.value=i}function k(){exact_price=document.getElementById("ajax_product_exact_price");price=document.getElementById("ajax_product_price");exact_price.value=price.value}$(".ajax_void_item").click(function(t){t.preventDefault();t.stopPropagation();var q=confirm($(this).data("confirm_message"));if(q==false){return false}var s=$(".ajax_response");var i=$(this).closest("form").attr("action");var p=$(this).siblings("input[name=csrf]").attr("value");var r=$(this).siblings("input[name=i_id]").attr("value");$.ajax({type:"POST",url:i,data:{csrf:p},beforeSend:function(){s.html('<div class="loading"><img src="/media/loading.gif" alt="Cargando..." /></div>')},success:function(y){$(".flash").hide("slow");s.html(y);var x=$("td:contains("+r+")");x.parent("tr").hide("slow");var v=x.closest("table").find(".counter");var u=v.html().trim();var w=parseInt(u,10);v.html(u.replace(w,w-1));$("[autofocus]").focus().select()},error:function(){s.html('<p class="error"><strong>Oops!</strong> Proba denuevo.</p>')}})})});