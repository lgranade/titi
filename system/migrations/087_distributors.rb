Sequel.migration do
  up do
    run 'DROP TABLE IF EXISTS distributors'
    run 'DROP TABLE IF EXISTS products_to_distributors'

    run '
      CREATE TABLE distributors (
        d_id int(5) UNSIGNED NOT NULL AUTO_INCREMENT,
        d_name char(20),
        d_has_pricelist tinyint(1) NOT NULL DEFAULT 1,
        d_notes text,
        created_at datetime DEFAULT NULL,
        updated_at datetime DEFAULT NULL,
        PRIMARY KEY (d_id),
        UNIQUE KEY (d_name),
        KEY (d_has_pricelist)
      );
    '

    run '
      CREATE TRIGGER d_insert BEFORE INSERT ON `distributors`
        FOR EACH ROW BEGIN
          SET NEW.created_at = IFNULL(NEW.created_at, NOW());
        END
    '
    run '
      CREATE TRIGGER d_update BEFORE UPDATE ON `distributors`
        FOR EACH ROW BEGIN
          SET NEW.updated_at = NOW();
        END
    '

    run '
      INSERT INTO distributors (d_name) VALUES ("Barrio Chino"), ("Belladersina"), ("Bs.As. Silver Plate"), ("Casa Fernandez"), ("Casa Norma"), ("Emolan"), ("Fantasias Acuario"), ("Glow"), ("Haydee"), ("J & R"), ("Jessamy"), ("Kany"), ("Kryolan"), ("Marili"), ("Mila Marzi"), ("Mundo Armador"), ("Nanmei"), ("Once"), ("Paso Doble"), ("Pigmento"), ("Pintafan"), ("Ron - Sky"), ("Valeria Navarlaz"), ("X");'

    run '
      CREATE TABLE products_to_distributors (
        p_id int(5) UNSIGNED NOT NULL,
        d_id int(5) UNSIGNED NOT NULL,
        created_at datetime DEFAULT NULL,
        UNIQUE KEY (p_id, d_id),
        UNIQUE KEY (d_id, p_id)
      );
    '

    run '
      CREATE TRIGGER ptd_insert BEFORE INSERT ON `products_to_distributors`
        FOR EACH ROW BEGIN
          SET NEW.created_at = IFNULL(NEW.created_at, NOW());
        END
    '

    run 'INSERT INTO products_to_distributors (p_id, d_id) VALUES (744, 1), (952, 1), (433, 1), (947, 1), (432, 1), (902, 2), (903, 2), (800, 2), (901, 2), (199, 2), (794, 2), (835, 2), (834, 2), (843, 2), (836, 2), (830, 2), (906, 2), (833, 2), (907, 2), (831, 2), (832, 2), (905, 2), (956, 2), (909, 2), (908, 2), (712, 2), (837, 2), (838, 2), (855, 2), (854, 2), (852, 2), (904, 2), (851, 2), (844, 2), (846, 2), (853, 2), (845, 2), (847, 2), (848, 2), (849, 2), (850, 2), (858, 2), (485, 3), (633, 3), (256, 3), (813, 3), (253, 3), (686, 3), (258, 3), (252, 3), (648, 3), (1061,  3), (427, 4), (999, 4), (589, 4), (1000,  4), (758, 4), (939, 4), (221, 4), (995, 4), (214, 4), (996, 4), (588, 4), (997, 4), (740, 4), (998, 4), (224, 4), (434, 5), (1053,  5), (1054,  5), (1055,  5), (1056,  5), (1057,  5), (1058,  5), (1059,  5), (1060,  5), (618, 6), (911, 6), (1048,  6), (1045,  6), (1046,  6), (1047,  6), (1044,  6), (1041,  6), (1042,  6), (1043,  6), (282, 6), (329, 6), (1033,  6), (1034,  6), (647, 6), (1036,  6), (1038,  6), (1050,  6), (1040,  6), (1037,  6), (1035,  6), (1049,  6), (1039,  6), (1023,  7), (1027,  7), (1028,  7), (1026,  7), (1021,  7), (1022,  7), (1024,  7), (1025,  7), (820, 8), (821, 8), (822, 8), (823, 8), (926, 8), (927, 8), (928, 8), (929, 8), (503, 9), (560, 11), (554, 11), (742, 11), (555, 11), (559, 11), (557, 11), (625, 11), (752, 11), (564, 11), (682, 11), (558, 11), (604, 11), (565, 11), (556, 11), (567, 11), (553, 11), (430, 12), (1029,  12), (1099,  12), (1100,  12), (311, 13), (498, 13), (296, 13), (298, 13), (297, 13), (304, 13), (303, 13), (319, 13), (608, 13), (912, 13), (828, 13), (913, 13), (299, 13), (313, 13), (247, 14), (248, 14), (241, 14), (439, 14), (677, 14), (1051,  14), (551, 14), (1052,  14), (875, 15), (788, 15), (637, 15), (940, 15), (781, 15), (941, 15), (324, 15), (792, 15), (876, 15), (782, 15), (783, 15), (367, 15), (475, 15), (549, 15), (703, 15), (873, 15), (361, 15), (579, 15), (356, 15), (780, 15), (779, 15), (327, 15), (365, 15), (808, 15), (874, 15), (785, 15), (348, 15), (789, 15), (829, 16), (418, 16), (1013,  16), (1014,  16), (1016,  16), (1020,  16), (1017,  16), (1018,  16), (1012,  16), (1015,  16), (1019,  16), (109, 16), (110, 16), (206, 16), (111, 16), (123, 16), (116, 16), (113, 16), (809, 16), (634, 16), (107, 16), (121, 16), (122, 16), (108, 16), (115, 16), (631, 16), (118, 16), (120, 16), (516, 16), (897, 17), (672, 17), (896, 17), (900, 17), (884, 17), (880, 17), (889, 17), (885, 17), (881, 17), (890, 17), (886, 17), (891, 17), (877, 17), (806, 17), (894, 17), (898, 17), (895, 17), (892, 17), (899, 17), (797, 17), (879, 17), (887, 17), (883, 17), (66,  17), (888, 17), (787, 18), (342, 18), (431, 19), (1030,  19), (865, 19), (262, 19), (870, 19), (864, 19), (871, 19), (869, 19), (866, 19), (265, 19), (861, 19), (263, 19), (261, 19), (862, 19), (264, 19), (863, 19), (867, 19), (1032,  19), (860, 19), (1031,  19), (953, 20), (954, 20), (955, 20), (826, 21), (825, 21), (824, 21), (827, 21), (916, 21), (917, 21), (1004,  21), (1001,  21), (918, 21), (1008,  21), (1009,  21), (1010,  21), (915, 21), (1006,  21), (919, 21), (920, 21), (921, 21), (922, 21), (1065,  21), (1066,  21), (923, 21), (924, 21), (1007,  21), (925, 21), (1002,  21), (1003,  21), (1005,  21), (1063,  22), (1062,  22), (1064,  22), (1067,  22), (1068,  22), (1069,  22), (426, 23), (425, 23), (420, 23), (421, 23), (422, 23), (428, 24), (622, 24), (210, 24), (332, 24), (379, 24), (1011,  24);'
  end

  down do
    drop_table :distributors
    drop_table :products_to_distributors
  end
end



